<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>庫存看板</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f4f5;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    }
    h1 {
      margin-top: 0;
      margin-bottom: 16px;
      font-size: 24px;
      text-align: center;
    }
    .subtitle {
      text-align: center;
      color: #6b7280;
      margin-bottom: 20px;
      font-size: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    thead {
      background: #f9fafb;
    }
    th, td {
      padding: 10px 12px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      font-size: 14px;
    }
    th {
      font-weight: 600;
      color: #4b5563;
    }
    tr:nth-child(even) td {
      background-color: #fafafa;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      background: #eef2ff;
      color: #4338ca;
    }
    .qty-ok {
      color: #16a34a;
      font-weight: 600;
    }
    .qty-low {
      color: #f97316;
      font-weight: 600;
    }
    .qty-out {
      color: #dc2626;
      font-weight: 600;
    }
    #status {
      margin-top: 10px;
      font-size: 12px;
      color: #6b7280;
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>貨架庫存看板</h1>
    <div class="subtitle">顯示目前每個貨架上的商品與剩餘數量（自動即時更新）</div>

    <table>
      <thead>
        <tr>
          <th>貨架</th>
          <th>商品名稱</th>
          <th>剩餘數量</th>
        </tr>
      </thead>
      <tbody id="inventory-body">
        <!-- 這裡會由 JavaScript 動態填入 -->
      </tbody>
    </table>

    <div id="status">正在連線 Firebase…</div>
  </div>

  <!-- Firebase + Firestore（v9 modular） -->
  <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
  import { getDatabase, ref, set, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";
  import { getFirestore, collection, getDocs }  from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-lite.js";

  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCcnUT8TN1RuiOBifEqEznRlogNrwX-sI0",
    authDomain: "ntuiot-f7743.firebaseapp.com",
    databaseURL: "https://ntuiot-f7743-default-rtdb.firebaseio.com",
    projectId: "ntuiot-f7743",
    storageBucket: "ntuiot-f7743.firebasestorage.app",
    messagingSenderId: "224195625096",
    appId: "1:224195625096:web:a0bcbefcf733f6b8d35f3d",
    measurementId: "G-VPMLNE6BF5"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
   const database = getDatabase(app);
    const tbody = document.getElementById("inventory-body");
    const status = document.getElementById("status");

    function renderRow(doc) {
      const data = doc.data();
      const tr = document.createElement("tr");

      // 決定數量樣式
      let qtyClass = "qty-ok";
      if (data.quantity === 0) qtyClass = "qty-out";
      else if (data.quantity <= 5) qtyClass = "qty-low";

      tr.innerHTML = `
        <td><span class="badge">${data.shelf || "-"}</span></td>
        <td>${data.name || "(未命名商品)"}</td>
        <td class="${qtyClass}">${data.quantity ?? 0}</td>
      `;
      return tr;
    }
	function renderProduct(data) {
	  // 清空原本表格
	  tbody.innerHTML = "";

	  if (!data) return;

	   Object.entries(data).forEach(([key, item]) => {
		const tr = document.createElement("tr");

		// 取出欄位
		const shelf  = item.table_id || "-";
		const name   = item.name || "(未命名商品)";
		const qtyNum = Number(item.number ?? 0);

		// 數量顏色樣式
		let qtyClass = "qty-ok";
		if (qtyNum === 0) qtyClass = "qty-out";
		else if (qtyNum <= 5) qtyClass = "qty-low";

		tr.innerHTML = `
		  <td><span class="badge">${shelf}</span></td>
		  <td>${name}</td>
		  <td class="${qtyClass}">${qtyNum}</td>
		`;

		tbody.appendChild(tr);
	  });
	}
	// 定義要監聽的路徑
	import { get, child } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

	const onlyReadRef = ref(database, 'product');
	console.log(onlyReadRef)
	const statusEl = document.getElementById("status");
	get(onlyReadRef)
	  .then((snapshot) => {
		if (snapshot.exists()) {
		  console.log("只讀取一次 onlyread 的數據:", snapshot.val());
		  const data = snapshot.val();
		  console.log("只讀取一次 onlyread 的數據:", data);

		  // ✅ 把 API 資料存到全域變數
		  var productData = data;

		  // ✅ 用這筆 data 更新畫面
		  renderProduct(productData);
		  statusEl.textContent = "資料已更新：" + new Date().toLocaleString();
		} else {
		  console.log("onlyread 路徑下沒有數據。");
		}
	  })
	  .catch((error) => {
		console.error("一次性數據讀取失敗:", error);
	  });


  </script>
</body>
</html>
